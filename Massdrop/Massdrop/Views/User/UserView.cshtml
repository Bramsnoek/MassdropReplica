
@{
    ViewBag.Title = "UserView";
    Layout = "~/Views/Shared/_ProductLayout.cshtml";
}

@{
    Massdrop.Models.User user = (Massdrop.Models.User)ViewData["User"];
}

<div class="page-container">
    <div class="container">
        <div class="row row-offcanvas row-offcanvas-left">
            <div class="col-xs-6 col-sm-3 sidebar-offcanvas" id="sidebar" role="navigation">
                <h3 style="margin-left: 15px; font-weight: 800;">MY SETTINGS</h3>
                <ul class="nav">
                    <li class="sideText"><a href="#home" aria-controls="home" role="tab" data-toggle="tab"><span class="glyphicon glyphicon-user pull-right"></span>User Info</a></li>
                    <li class="sideText"><a href="#shipping" aria-controls="shipping" role="tab" data-toggle="tab"><span class="glyphicon glyphicon-book pull-right"></span> Shipping Adresses</a></li>
                </ul>
            </div>

            <div class="Content-Wrapper">
                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane active" id="home">
                        <div class="panel panel-default adjusted top">
                            <div class="panel-heading"><h4>Basic</h4></div>
                            <div class="panel-body">
                                <div class="panel-wrapper">
                                    <form>
                                        <div class="form-group row adjusted" style="height: 38px;">
                                            <label for="inputPassword3" class="col-sm-2 form-control-label adjusted">Username</label>
                                            <div class="col-sm-10">
                                                <input type="text" class="form-control" id="ChangeUsernameInput" placeholder="Username">
                                            </div>
                                        </div>

                                        <div class="form-group row adjusted">
                                            <label for="inputPassword3" class="col-sm-2 form-control-label adjusted">Full Name</label>
                                            <div class="col-sm-10">
                                                <input type="text" class="form-control" id="ChangeNameInput" placeholder="Full Name">
                                            </div>
                                        </div>
                                    </form>
                                </div>

                            </div>
                        </div>

                        <div class="panel panel-default adjusted">
                            <div class="panel-heading">
                                <h3 class="panel-title">Email & Password</h3>
                            </div>
                            <div class="panel-body">
                                <div class="panel-wrapper">
                                    <div class="form-group row adjusted">
                                        <label for="InputEmail2" class="col-sm-2 form-control-label adjusted">Email</label>
                                        <div class="col-sm-10">
                                            <input type="email" class="form-control" id="ChangeEmailInput" placeholder="jane.doe@example.com">
                                        </div>
                                    </div>

                                    <div class="form-group row adjusted">
                                        <label for="inputPassword3" class="col-sm-2 form-control-label adjusted">Old Password</label>
                                        <div class="col-sm-10">
                                            <input type="password" class="form-control adjusted" id="ChangePWInputOld">
                                        </div>
                                    </div>

                                    <div class="form-group row adjusted">
                                        <label for="inputPassword3" class="col-sm-2 form-control-label adjusted">New Password</label>
                                        <div class="col-sm-10">
                                            <input type="password" class="form-control adjusted" id="ChangePWInputNew"
                                                   placeholder="Please enter a new password">
                                        </div>
                                    </div>

                                    <div class="form-group row adjusted ">
                                        <label for="inputPassword3" class="col-sm-2 form-control-label adjusted">Retype new password</label>
                                        <div class="col-sm-10">
                                            <input type="password" class="form-control adjusted" id="ChangePWInputNewCheck"
                                                   placeholder="Confirm your new password">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <p class="buttongroup">
                            <a class="btn btn-sm btn-primary" style="background: #00aeda; border-color: #00aeda; margin-right: 15px; width: 96px;" href="#" role="button" onclick="ChangeUser()">SAVE</a>
                            <a class="btn btn-sm btn-secondary" style="border: .05px solid #8dd8ec; " href="#" role="button">
                                CANCEL
                            </a>
                        </p>
                    </div>

                    <div role="tabpanel" class="tab-pane" id="shipping">
                        <div role="tabpanel" class="tab-pane active" id="home">
                            <div class="panel panel-default adjusted top">
                                <div class="panel-heading"><h4>Shipping Addresses</h4></div>
                                <div class="panel-body">
                                    <div class="panel-wrapper adjusted">
                                        @foreach (Massdrop.Models.Shipping_Address address in user.Shipping_Addresses)
                                        {
                                            var phoneNumber = (address.PhoneNumber == 0) ? 0000000000 : address.PhoneNumber;

                                            <form>
                                                <div class="ShippingInfo">
                                                    <h4>@address.City</h4>
                                                    <h5>@address.Address, @address.PostalCode</h5>
                                                    <h5>@address.Province</h5>
                                                    <div class="ShippingButtons" style="float:right; margin-bottom: 5px;">
                                                        <button type="button" id="@address.ID" class="btn btn-danger" onclick="RemoveShipping(this.id)">Delete</button>
                                                    </div>
                                                </div>

                                            </form>}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <p class="buttongroup">
                            <a class="btn btn-sm btn-primary" style="background: #00aeda; border-color: #00aeda; margin-right: 15px; width: 96px;" href="#newShipping" aria-controls="newShipping" role="tab" data-toggle="tab">ADD</a>
                        </p>
                    </div>

                    <div role="tabpanel" class="tab-pane" id="newShipping">
                        <div class="panel panel-default adjusted top">
                            <div class="panel-heading"><h4>New Shipping Address</h4></div>
                            <div class="panel-body">
                                <div class="panel-wrapper">
                                    <form>
                                        <div class="form-group row adjusted" style="height: 38px;">
                                            <label for="Input" class="col-sm-2 form-control-label adjusted">Country</label>
                                            <div class="col-sm-10">
                                                <input type="text" class="form-control" id="CountryInput" placeholder="Country">
                                            </div>
                                        </div>

                                        <div class="form-group row adjusted" style="height: 38px;">
                                            <label for="Input" class="col-sm-2 form-control-label adjusted adjusted">Name</label>
                                            <div class="col-sm-10">
                                                <input type="text" class="form-control" id="NameInput" placeholder="Name">
                                            </div>
                                        </div>

                                        <div class="form-group row adjusted" style="height: 38px;">
                                            <label for="Input" class="col-sm-2 form-control-label adjusted">Address</label>
                                            <div class="col-sm-10">
                                                <input type="text" class="form-control" id="AddressInput" placeholder="Address">
                                            </div>
                                        </div>

                                        <div class="form-group row adjusted" style="height: 38px;">
                                            <label for="Input" class="col-sm-2 form-control-label adjusted">City</label>
                                            <div class="col-sm-10">
                                                <input type="text" class="form-control" id="CityInput" placeholder="City">
                                            </div>
                                        </div>


                                        <div class="form-group row adjusted" style="height: 38px;">
                                            <label for="Input" class="col-sm-2 form-control-label adjusted">Postalcode</label>
                                            <div class="col-sm-10">
                                                <input type="text" class="form-control" id="PostalCodeInput" placeholder="Postalcode">
                                            </div>
                                        </div>


                                        <div class="form-group row adjusted" style="height: 38px;">
                                            <label for="Input" class="col-sm-2 form-control-label adjusted">Phone Number</label>
                                            <div class="col-sm-10">
                                                <input type="text" class="form-control" id="PhoneNumberInput" placeholder="Phone Number">
                                            </div>
                                        </div>
                                    </form>
                                    <p class="buttongroup">
                                        <a class="btn btn-sm btn-primary" style="background: #00aeda; border-color: #00aeda; margin-right: 15px; width: 96px;" onclick="AddShipping()">SAVE</a>
                                        <a class="btn btn-sm btn-secondary" style="border: .05px solid #8dd8ec; " border-color #00aeda; margin-right 15px; width 96px;" href="#shipping" aria-controls="shipping" role="tab" data-toggle="tab">CANCEL</a>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function ChangeUser() {
        var username = $('#ChangeUsernameInput').val();
        var name = $('#ChangeNameInput').val();
        var email = $('#ChangeEmailInput').val();

        var oldpassword = $('#ChangePWInputOld').val();

        var newpassword = $('#ChangePWInputNew').val();
        var newpasswordcheck = $('#ChangePWInputNew').val();

        if (newpassword != newpasswordcheck) {
            alert("The new passwords don't match!");
        }

        $.ajax({
            type: "GET",
            url: "/User/ChangeUserInfo",
            data: { userName: username, name: name, email: email, password: newpassword, oldpassword: oldpassword },
            dataType: "json",
            success: function (data) {
                if (data == 1) {
                    alert('Info changed succesfully!')
                }
                else {
                    alert('The password is incorrect!');
                }
            },
            failure: function (data) {
            }
        });

    }

    function RemoveShipping(shippingId) {
        $.ajax({
            type: "GET",
            url: "/User/RemoveShippingAddres",
            data: { id: shippingId },
            dataType: "json",
            success: function (data) {
                location.reload();
            },
            failure: function (data) {
            }
        });
    }

    function AddShipping() {
        var Country = $('#CountryInput').val();
        var Name = $('#NameInput').val();
        var Address = $('#AddressInput').val();
        var City = $('#CityInput').val();
        var Postalcode = $('#PostalCodeInput').val();
        var Phonenumber = $('#PhoneNumberInput').val();

        if (Country == "") {
            alert('Please fill in a country!');
            return;
        }
        if (Name == "") {
            alert('Please fill in a name!');
            return;
        }
        if (Address == "") {
            alert('Please fill in an address!');
            return;
        }
        if (City == "") {
            alert('Please fill in a city!');
            return;
        }
        if (Postalcode == "") {
            alert('Please fill in a postalcode!');
            return;
        }

        $.ajax({
            type: "GET",
            url: "/User/AddShippingAddress",
            data: { address: Address, city: City, province: City, postalcode: Postalcode, phonenumber: Phonenumber },
            dataType: "json",
            success: function (data) {
                if (data == 1) {
                    location.reload();
                }
            },
            failure: function (data) {
            }
        });
    }
</script>
